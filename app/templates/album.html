<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–æ–π –∞–ª—å–±–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</title>
<style>
body{font-family:Arial,sans-serif;max-width:1200px;margin:0 auto;padding:20px;background:#f9f9f9}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;background:#fff;padding:20px;border-radius:8px}
h1{color:#333;margin:0}
.upload-more{display:inline-block;padding:10px 20px;background:#4CAF50;color:white;text-decoration:none;border-radius:4px}
.upload-more:hover{background:#45a049}
.image-grid{display:flex;flex-direction:column;gap:20px}
.image-item{border:1px solid #ddd;border-radius:8px;overflow:hidden;background:#fff;display:flex;flex-direction:column}
.image-item img{width:100%;height:auto;display:block}
.image-info{padding:15px}
.image-name{font-weight:bold;margin-bottom:5px;color:#333;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.copy-btn{background:#2196F3;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;font-size:12px}
.copy-btn:hover{background:#0b7dda}
.copy-btn.copied{background:#4CAF50}
.delete-btn{background:#f44336;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;font-size:12px;margin-left:5px}
.delete-btn:hover{background:#d32f2f}
.delete-album-btn{background:#ff5722;color:white;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;text-decoration:none}
.delete-album-btn:hover{background:#e64a19}
.empty-state{text-align:center;padding:60px 20px;background:#fff;border-radius:8px}
.empty-icon{font-size:64px;margin-bottom:20px;color:#ccc}
.empty-text{font-size:18px;color:#666;margin-bottom:20px}
.empty-link{display:inline-block;padding:10px 20px;background:#4CAF50;color:white;text-decoration:none;border-radius:4px}
.empty-link:hover{background:#45a049}
@media(max-width:768px){
.header{flex-direction:column;gap:15px;text-align:center}
}
</style>
</head>
<body>
<div class="header">
<h1>–ê–ª—å–±–æ–º: {{.AlbumID}}</h1>
<div>
<a href="/" class="upload-more">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
{{if .IsOwner}}
<form action="/delete-album" method="POST" style="display:inline;" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –∞–ª—å–±–æ–º —Å–æ –≤—Å–µ–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏?')">
<input type="hidden" name="album_id" value="{{.AlbumID}}">
<button type="submit" class="delete-album-btn">–£–¥–∞–ª–∏—Ç—å –∞–ª—å–±–æ–º</button>
</form>
{{end}}
</div>
</div>
{{if .HasImages}}
<div class="image-grid" id="imageGrid">
{{range .Images}}
<div class="image-item">
<img src="/{{$.SessionID}}/{{$.AlbumID}}/{{.Filename}}" alt="{{.Filename}}">
<div class="image-info">
<div class="image-name">{{.Filename}}</div>
<div>
<button class="copy-btn" onclick="copyUrl('{{$.SessionID}}','{{$.AlbumID}}','{{.Filename}}',this)">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL</button>
{{if $.IsOwner}}
<button class="delete-btn" onclick="deleteImage('{{$.SessionID}}','{{$.AlbumID}}','{{.Filename}}',this)">–£–¥–∞–ª–∏—Ç—å</button>
{{end}}
</div>
</div>
</div>
{{end}}
</div>
{{else}}
<div class="empty-state">
<div class="empty-icon">üì∑</div>
<div class="empty-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>
<a href="/" class="empty-link">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</a>
</div>
{{end}}
<script>
function copyUrl(sessionID,albumID,filename,button){
const url=window.location.origin+'/'+sessionID+'/'+albumID+'/'+filename;
if(navigator.clipboard){
navigator.clipboard.writeText(url).then(function(){
const originalText=button.textContent;
button.textContent='–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
button.classList.add('copied');
setTimeout(function(){button.textContent=originalText;button.classList.remove('copied')},2000);
}).catch(function(err){console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL: ',err)});
}else{
const textArea=document.createElement('textarea');
textArea.value=url;
document.body.appendChild(textArea);
textArea.focus();
textArea.select();
try{
document.execCommand('copy');
const originalText=button.textContent;
button.textContent='–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
button.classList.add('copied');
setTimeout(function(){button.textContent=originalText;button.classList.remove('copied')},2000);
}catch(err){console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL: ',err)}
document.body.removeChild(textArea);
}
}

function deleteImage(sessionID,albumID,filename,button){
	if(!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')){
		return;
	}
	
	const formData=new FormData();
	formData.append('album_id',albumID);
	formData.append('filename',filename);
	
	fetch('/delete-image',{
		method:'POST',
		body:formData
	})
	.then(response=>{
		if(response.ok){
			// –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ DOM
			const imageItem=button.closest('.image-item');
			imageItem.style.opacity='0.5';
			setTimeout(()=>{
				imageItem.remove();
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
				const remainingImages=document.querySelectorAll('.image-item');
				if(remainingImages.length===0){
					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
					const imageGrid=document.getElementById('imageGrid');
					imageGrid.innerHTML='<div class="empty-state"><div class="empty-icon">üì∑</div><div class="empty-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div><a href="/" class="empty-link">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</a></div>';
				}
			},300);
		}else{
			alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
		}
	})
	.catch(error=>{
		console.error('Error:',error);
		alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
	});
}
</script>
</body>
</html>