<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>·¥ò–∏–ø–∏·¥ã·¥Ñ  Ä·¥á ô·¥è Ä…¥</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
  <div class="header">
    <h1>–ê–ª—å–±–æ–º: {{.AlbumID}}</h1>
    <div>
      <a href="/" class="upload-more">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
      {{if .IsOwner}}
      <form action="/delete-album" method="POST" style="display:inline;"
        onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –∞–ª—å–±–æ–º —Å–æ –≤—Å–µ–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏?')">
        <input type="hidden" name="album_id" value="{{.AlbumID}}">
        <button type="submit" class="delete-album-btn">–£–¥–∞–ª–∏—Ç—å –∞–ª—å–±–æ–º</button>
      </form>
      {{end}}
    </div>
  </div>
  
  {{if .IsOwner}}
  <div class="upload-container">
    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">üìÅ</div>
      <div class="upload-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—é–¥–∞</div>
      <div class="upload-hint">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤</div>
    </div>
    <form action="/upload" method="post" enctype="multipart/form-data" id="imageUploadForm">
      <input type="hidden" name="album_id" value="{{.AlbumID}}">
      <input type="file" name="image" accept="image/*" multiple id="fileInput">
    </form>
  </div>
  {{end}}
  {{if .HasImages}}
  <div class="image-grid" id="imageGrid">
    {{range .Images}}
    <div class="image-item">
      <img src="/{{$.OwnerSessionID}}/{{$.AlbumID}}/{{.Filename}}" alt="{{.Filename}}">
      <div class="image-info">
        <div class="image-name">{{.Filename}}</div>
        <div>
          <button class="copy-btn"
            onclick="copyUrl('{{$.OwnerSessionID}}','{{$.AlbumID}}','{{.Filename}}',this)">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL</button>
          {{if $.IsOwner}}
          <button class="delete-btn"
            onclick="deleteImage('{{$.SessionID}}','{{$.AlbumID}}','{{.Filename}}',this)">–£–¥–∞–ª–∏—Ç—å</button>
          {{end}}
        </div>
      </div>
    </div>
    {{end}}
  </div>
  {{else}}
  <div class="empty-state">
    <div class="empty-icon">üì∑</div>
    <div class="empty-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>
    <a href="/" class="empty-link">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</a>
  </div>
  {{end}}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const uploadArea = document.getElementById('uploadArea');
      const fileInput = document.getElementById('fileInput');
      const uploadForm = document.getElementById('imageUploadForm');
      
      if (uploadArea && fileInput && uploadForm) {
        uploadArea.addEventListener('click', function () { fileInput.click() });
        fileInput.addEventListener('change', function () {
          if (fileInput.files.length > 0) {
            uploadForm.submit();
          }
        });
        uploadArea.addEventListener('dragover', function (e) { e.preventDefault(); uploadArea.classList.add('dragover') });
        uploadArea.addEventListener('dragleave', function (e) { e.preventDefault(); uploadArea.classList.remove('dragover') });
        uploadArea.addEventListener('drop', function (e) {
          e.preventDefault(); uploadArea.classList.remove('dragover');
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            fileInput.files = files;
            uploadForm.submit();
          }
        });
      }
    });

    function copyUrl(sessionID, albumID, filename, button) {
      const url = window.location.origin + '/' + sessionID + '/' + albumID + '/' + filename;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(url).then(function () {
          const originalText = button.textContent;
          button.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
          button.classList.add('copied');
          setTimeout(function () { button.textContent = originalText; button.classList.remove('copied') }, 2000);
        }).catch(function (err) { console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL: ', err) });
      } else {
        const textArea = document.createElement('textarea');
        textArea.value = url;
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        try {
          document.execCommand('copy');
          const originalText = button.textContent;
          button.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
          button.classList.add('copied');
          setTimeout(function () { button.textContent = originalText; button.classList.remove('copied') }, 2000);
        } catch (err) { console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å URL: ', err) }
        document.body.removeChild(textArea);
      }
    }

    function deleteImage(sessionID, albumID, filename, button) {
      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ?')) {
        return;
      }

      const formData = new FormData();
      formData.append('album_id', albumID);
      formData.append('filename', filename);

      fetch('/delete-image', {
        method: 'POST',
        body: formData
      })
        .then(response => {
          if (response.ok) {
            // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ DOM
            const imageItem = button.closest('.image-item');
            imageItem.style.opacity = '0.5';
            setTimeout(() => {
              imageItem.remove();
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
              const remainingImages = document.querySelectorAll('.image-item');
              if (remainingImages.length === 0) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                const imageGrid = document.getElementById('imageGrid');
                imageGrid.innerHTML = '<div class="empty-state"><div class="empty-icon">üì∑</div><div class="empty-text">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div><a href="/" class="empty-link">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</a></div>';
              }
            }, 300);
          } else {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
        });
    }
  </script>
</body>

</html>