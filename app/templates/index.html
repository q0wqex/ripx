<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>·¥ò–∏–ø–∏·¥ã·¥Ñ  Ä·¥á ô·¥è Ä…¥</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
  <h1>·¥ò–∏–ø–∏·¥ã·¥Ñ  Ä·¥á ô·¥è Ä…¥</h1>
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <p>–Ω–µ—É–±–∏–≤–∞–µ–º—ã–π</p>
    <button type="button" class="delete-user-btn" onclick="deleteUser()">–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
  </div>

  <div class="upload-container">
    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">üìÅ</div>
      <div class="upload-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—é–¥–∞</div>
      <div class="upload-hint">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤</div>
    </div>
    <form action="/upload" method="post" enctype="multipart/form-data" id="uploadForm">
      <input type="file" name="image" accept="image/*" multiple id="fileInput">
    </form>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–ª—å–±–æ–º–æ–≤ -->
  {{if .HasAlbums}}
  <div class="albums-container">
    <div class="albums-title">–í–∞—à–∏ –∞–ª—å–±–æ–º—ã</div>
    <div class="albums-list">
      {{range .Albums}}
      <a href="/{{$.SessionID}}/{{.ID}}" class="album-link" style="text-decoration:none;display:block;">
        <div class="album-item">
          <div style="font-weight:bold;color:#333;">{{.Name}}</div>
          <div class="album-count">{{.ImageCount}} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</div>
          <div class="album-count">–°–æ–∑–¥–∞–Ω: {{.CreatedAt.Format "02.01.2006 15:04"}}</div>
        </div>
      </a>
      {{end}}
    </div>
  </div>
  {{end}}

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const uploadArea = document.getElementById('uploadArea');
      const fileInput = document.getElementById('fileInput');
      const uploadForm = document.getElementById('uploadForm');
      uploadArea.addEventListener('click', function () { fileInput.click() });
      fileInput.addEventListener('change', function () {
        if (fileInput.files.length > 0) {
          uploadForm.submit();
        }
      });
      uploadArea.addEventListener('dragover', function (e) { e.preventDefault(); uploadArea.classList.add('dragover') });
      uploadArea.addEventListener('dragleave', function (e) { e.preventDefault(); uploadArea.classList.remove('dragover') });
      uploadArea.addEventListener('drop', function (e) {
        e.preventDefault(); uploadArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          fileInput.files = files;
          uploadForm.submit();
        }
      });
    });

    function deleteUser() {
      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ—Ñ–∏–ª—å —Å–æ –≤—Å–µ–º–∏ –∞–ª—å–±–æ–º–∞–º–∏ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) {
        return;
      }

      fetch('/delete-user', {
        method: 'POST'
      })
        .then(response => {
          if (response.ok) {
            // –£–¥–∞–ª—è–µ–º cookie –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
            document.cookie = 'session_id=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
            window.location.reload();
          } else {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è');
        });
    }
  </script>
</body>

</html>